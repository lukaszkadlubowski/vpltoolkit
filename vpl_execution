#!/bin/bash
rm -f $0

if [ -f ./env.sh ] ; then
    source ./env.sh
elif [ -f $HOME/env.sh ] ; then
    source $HOME/env.sh
else
    echo "⚠ File \"env.sh\" is missing!" && exit 0
fi

[ -z "$MODE" ] && echo "⚠ Variable \"MODE\" is not defined!" && exit 0
if [ "$MODE" = "RUN" ] ; then
    CMD="$RUNDIR/run.sh"
elif [ "$MODE" = "EVAL" ] ; then
    CMD="$RUNDIR/eval.sh"
else
    echo "⚠ Invalid \"MODE\" selected!" && exit 0
fi

[ ! -f "$CMD" ] && echo "⚠ File \"$CMD\" not found!" && exit 0
[ -z "$RUNDIR" ] && echo "⚠ Variable \"RUNDIR\" is not defined!" && exit 0

### launch command

LAUNCHCMD="bash"
[ "$DEBUG" = "1" ] && LAUNCHCMD="bash -x"

# docker support
DOCKER="gblin/vpljail"

if [ -n "$DOCKER" ] ; then 
     # check if docker image is already installed
    docker image inspect $DOCKER &> /dev/null
    [ $? -ne 0 ] && echo "⚠ Docker image \"$DOCKER\" is required, but not installed!" && exit 0
    LAUNCHCMD="docker run -t $DOCKER $LAUNCHCMD"
fi

# Let's rock
cd $RUNDIR && $LAUNCHCMD $CMD $ARGS

# EOF
