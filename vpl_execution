#!/bin/bash
rm -f $0

if [ -f ./env.sh ] ; then
    source ./env.sh
elif [ -f $HOME/env.sh ] ; then
    source $HOME/env.sh
else
    echo "⚠ File \"env.sh\" is missing!" && exit 0
fi

[ -z "$MODE" ] && echo "⚠ Variable \"MODE\" is not defined!" && exit 0
if [ "$MODE" = "RUN" ] ; then
    CMD="$RUNDIR/run.sh"
elif [ "$MODE" = "EVAL" ] ; then
    CMD="$RUNDIR/eval.sh"
else
    echo "⚠ Invalid \"MODE\" selected!" && exit 0
fi

[ ! -f "$CMD" ] && echo "⚠ File \"$CMD\" not found!" && exit 0
[ -z "$RUNDIR" ] && echo "⚠ Variable \"RUNDIR\" is not defined!" && exit 0

### shell command
SHELLCMD="bash"
[ "$DEBUG" = "1" ] && SHELLCMD="bash -x"

### docker support
DOCKERCMD=""
if [ -n "$DOCKER" ] ; then
     # check if docker image is already installed
    docker image inspect $DOCKER &> /dev/null
    [ $? -ne 0 ] && echo "⚠ Docker image \"$DOCKER\" is required, but not locally installed!" && exit 0
    DOCKERCMD="docker run -i -v $RUNDIR:$RUNDIR -w $RUNDIR -t $DOCKER"
    echo $DOCKERCMD
fi

### Let's rock
echo "Run: $DOCKERCMD $SHELLCMD $CMD $ARGS"
cd $RUNDIR && $DOCKERCMD bash

# cd $RUNDIR && $DOCKERCMD $SHELLCMD $CMD $ARGS
[ "$ONLINE" = "0" ] && echo "=> cd $RUNDIR && $DOCKERCMD bash"

# EOF
